{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"passport\"","webpack:///external \"apollo-server-express\"","webpack:///external \"cors\"","webpack:///external \"express\"","webpack:///external \"http\"","webpack:///external \"express-session\"","webpack:///external \"uuid/v4\"","webpack:///external \"graphql-subscriptions\"","webpack:///external \"passport-strategy\"","webpack:///./src/passport/localStrategy.ts","webpack:///./src/passport/buildPassportContext.ts","webpack:///./src/resolvers.ts","webpack:///./src/typeDefs.ts","webpack:///./src/users.ts","webpack:///./src/index.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","cb","super","this","verify","req","options","email","password","error","user","info","success","fail","request","response","isAuthenticated","authenticate","authenticateOptions","strategyName","Promise","resolve","reject","authenticateFunction","getUserId","id","Error","login","err","logout","Query","parent","args","passport","Mutation","loginUser","async","data","firstName","lastName","serializeUser","done","deserializeUser","users","find","use","matchingUser","passportMiddleware","initialize","passportSessionMiddleware","session","expressMiddleware","expressSessionMiddleware","genid","resave","saveUninitialized","secret","credentials","origin","pubsub","server","context","buildPassportContext","res","playground","settings","resolvers","typeDefs","applyMiddleware","app","cors","path","httpServer","createServer","installSubscriptionHandlers","listen","process","env","PORT","console","log","graphqlPath","subscriptionsPath"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 9);\n","module.exports = require(\"passport\");","module.exports = require(\"apollo-server-express\");","module.exports = require(\"cors\");","module.exports = require(\"express\");","module.exports = require(\"http\");","module.exports = require(\"express-session\");","module.exports = require(\"uuid/v4\");","module.exports = require(\"graphql-subscriptions\");","module.exports = require(\"passport-strategy\");","import { Request } from 'express';\nimport { Strategy } from 'passport-strategy';\nimport { Done, Info, VerifyFunction } from './passportTypes';\n\nclass LocalStrategy extends Strategy {\n  public constructor(cb: VerifyFunction) {\n    super();\n    this.verify = cb;\n    this.name = 'local';\n  }\n\n  public verify: VerifyFunction;\n\n  public name: string;\n\n  public authenticate(req: Request, options: { email: string; password: string }): void {\n    const { email, password } = options;\n\n    const done: Done = (error: Error, user: object, info?: Info) => {\n      if (error) {\n        // @ts-ignore\n        return this.error(error);\n      }\n      if (!user) {\n        // @ts-ignore\n        return this.fail(info, 401);\n      }\n      // @ts-ignore\n      return this.success(user, info);\n    };\n\n    this.verify(email, password, done);\n  }\n}\n\nexport default LocalStrategy;\n","import passport from 'passport';\nimport {\n  AuthenticateParams,\n  AuthenticateReturn,\n  BuildPassportContextParams,\n  Done,\n  ExpressParams,\n  Info,\n  LoginParams,\n  PromisifiedAuthenticateParams,\n  PromisifiedLoginParams,\n} from './passportTypes';\n\nconst promisifiedAuthenticate = ({\n  authenticateOptions,\n  request,\n  response,\n  strategyName,\n}: PromisifiedAuthenticateParams): Promise<AuthenticateReturn> => (\n  new Promise<AuthenticateReturn>((resolve, reject) => {\n    const done: Done = (\n      error: Error | undefined,\n      user: object | undefined,\n      info?: Info | undefined,\n    ): void => {\n      if (error) reject(error);\n      else resolve({ user, info });\n    };\n\n    const authenticateFunction = passport.authenticate(strategyName, authenticateOptions, done);\n    return authenticateFunction(request, response);\n  }));\n\nconst promisifiedLogin = ({\n  authenticateOptions,\n  request,\n  user,\n}: PromisifiedLoginParams): Promise<void> => new Promise<void>((resolve, reject) => {\n  const done = (err: Error | undefined): void => {\n    if (err) reject(err);\n    else resolve();\n  };\n\n  request.login(user, authenticateOptions, done);\n});\n\nexport default ({ request, response }: ExpressParams): BuildPassportContextParams => {\n  const authenticate = (\n    { authenticateOptions, strategyName }: AuthenticateParams,\n  ): Promise<AuthenticateReturn> => (\n    promisifiedAuthenticate({\n      authenticateOptions,\n      request,\n      response,\n      strategyName,\n    })\n  );\n\n  const isAuthenticated = (): boolean => request.isAuthenticated();\n\n  const getUserId = (): string => {\n    if (isAuthenticated()) {\n      // @ts-ignore\n      return request.user.id;\n    }\n    throw Error('Passport Context getUserId error: User is not authenticated');\n  };\n\n  const login = ({ authenticateOptions, user }: LoginParams): Promise<void> => (\n    promisifiedLogin({ authenticateOptions, request, user })\n  );\n\n  const logout = (): void => request.logout();\n\n  return {\n    authenticate,\n    getUserId,\n    isAuthenticated,\n    login,\n    logout,\n  };\n};\n","const resolvers = {\n  Query: {\n    isAuthenticated: (parent, args, { passport }) => passport.isAuthenticated(),\n  },\n  Mutation: {\n    loginUser: async (parent, args, { passport }) => {\n      const { user } = await passport.authenticate({\n        authenticateOptions: args.data,\n        strategyName: 'local',\n      });\n\n      passport.login({ authenticateOptions: args.data, user });\n\n      return user;\n    },\n  },\n};\n\nexport default resolvers;\n","import { gql } from 'apollo-server-express';\n\nconst typeDefs = gql`\n  type User {\n    id: String\n    firstName: String\n    lastName: String\n    email: String\n  }\n  input LoginUserInput {\n    email: String!\n    password: String!\n  }\n  type Query {\n    isAuthenticated: Boolean\n  }\n  type Mutation {\n    loginUser(data: LoginUserInput): User!\n  }\n`;\n\nexport default typeDefs;\n","export default [\n  {\n    id: '1',\n    firstName: 'John',\n    lastName: 'Smith',\n    email: 'john@gmail.com',\n    password: 'abc',\n  },\n];\n","import cors from 'cors';\nimport express from 'express';\nimport http from 'http';\nimport passport from 'passport';\nimport session from 'express-session';\nimport uuid from 'uuid/v4';\nimport { ApolloServer } from 'apollo-server-express';\nimport { PubSub } from 'graphql-subscriptions';\nimport LocalStrategy from './passport/localStrategy';\nimport buildPassportContext from './passport/buildPassportContext';\nimport resolvers from './resolvers';\nimport typeDefs from './typeDefs';\nimport users from './users';\n\n// ----- INITIALIZE PASSPORT ----- //\n\npassport.serializeUser((user: any, done) => done(null, user.id));\n\npassport.deserializeUser((id, done) => {\n  const matchingUser = users.find((user) => user.id === id);\n  done(null, matchingUser);\n});\n\npassport.use(\n  new LocalStrategy((email, password, done) => {\n    const matchingUser = users.find((user) => email === user.email && password === user.password);\n    const error = matchingUser ? null : new Error('no matching user');\n    done(error, matchingUser);\n  }),\n);\n\nconst passportMiddleware = passport.initialize();\nconst passportSessionMiddleware = passport.session();\n\n// ----- INITIALIZE EXPRESS ----- //\n\nconst expressMiddleware = express();\nconst expressSessionMiddleware = session({\n  genid: (request) => uuid(),\n  resave: false,\n  saveUninitialized: false,\n  secret: 'sample_session_secret',\n});\n\nexpressMiddleware.use(cors({\n  credentials: true,\n  origin: 'http://localhost:8080',\n}));\n\nexpressMiddleware.use(expressSessionMiddleware);\nexpressMiddleware.use(passportMiddleware);\nexpressMiddleware.use(passportSessionMiddleware);\n\n// ----- INITIALIZE OUR SERVER ----- //\n\nconst pubsub = new PubSub();\n\nconst server = new ApolloServer({\n  context: (request) => ({\n    passport: buildPassportContext({ request: request.req, response: request.res }),\n    pubsub,\n  }),\n  playground: {\n    settings: {\n      'request.credentials': 'same-origin',\n    },\n  },\n  resolvers,\n  typeDefs,\n});\n\nserver.applyMiddleware({\n  app: expressMiddleware,\n  cors: false,\n  path: '/graphql',\n});\n\n// ----- RUNNING THE SERVER ----- //\n\nconst httpServer = http.createServer(expressMiddleware);\nserver.installSubscriptionHandlers(httpServer);\n\nhttpServer.listen(process.env.PORT, () => {\n  console.log(`Server ready at http://localhost:${process.env.PORT}${server.graphqlPath}`);\n  console.log(`Subscriptions ready at ws://localhost:${process.env.PORT}${server.subscriptionsPath}`);\n});\n\nif (process.env.NODE_ENV !== 'PROD' && module.hot) {\n  module.hot.accept();\n  module.hot.dispose(() => server.stop());\n}\n"],"sourceRoot":""}
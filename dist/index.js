!function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=9)}([function(e,t){e.exports=require("passport")},function(e,t){e.exports=require("apollo-server-express")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("uuid/v4")},function(e,t){e.exports=require("graphql-subscriptions")},function(e,t){e.exports=require("passport-strategy")},function(e,t,r){e.exports=r(10)},function(e,t,r){"use strict";r.r(t);var s=r(2),n=r.n(s),i=r(3),o=r.n(i),a=r(4),u=r.n(a),c=r(0),p=r.n(c),l=r(5),d=r.n(l),f=r(6),g=r.n(f),h=r(1),y=r(7),m=r(8);class v extends m.Strategy{constructor(e){super(),this.verify=e,this.name="local"}authenticate(e,t){const{email:r,password:s}=t;this.verify(r,s,(e,t,r)=>e?this.error(e):t?this.success(t,r):this.fail(r,401))}}var b=v;var q=({request:e,response:t})=>{const r=()=>e.isAuthenticated();return{authenticate:({authenticateOptions:r,strategyName:s})=>(({authenticateOptions:e,request:t,response:r,strategyName:s})=>new Promise((n,i)=>{return p.a.authenticate(s,e,(e,t,r)=>{e?i(e):n({user:t,info:r})})(t,r)}))({authenticateOptions:r,request:e,response:t,strategyName:s}),getUserId:()=>{if(r())return e.user.id;throw Error("Passport Context getUserId error: User is not authenticated")},isAuthenticated:r,login:({authenticateOptions:t,user:r})=>(({authenticateOptions:e,request:t,user:r})=>new Promise((s,n)=>{t.login(r,e,e=>{e?n(e):s()})}))({authenticateOptions:t,request:e,user:r}),logout:()=>e.logout()}};var x={Query:{isAuthenticated:(e,t,{passport:r})=>r.isAuthenticated()},Mutation:{loginUser:async(e,t,{passport:r})=>{const{user:s}=await r.authenticate({authenticateOptions:t.data,strategyName:"local"});return r.login({authenticateOptions:t.data,user:s}),s}}};var S=h.gql`
  type User {
    id: String
    firstName: String
    lastName: String
    email: String
  }
  input LoginUserInput {
    email: String!
    password: String!
  }
  type Query {
    isAuthenticated: Boolean
  }
  type Mutation {
    loginUser(data: LoginUserInput): User!
  }
`,O=[{id:"1",firstName:"John",lastName:"Smith",email:"john@gmail.com",password:"abc"}];p.a.serializeUser((e,t)=>t(null,e.id)),p.a.deserializeUser((e,t)=>{t(null,O.find(t=>t.id===e))}),p.a.use(new b((e,t,r)=>{const s=O.find(r=>e===r.email&&t===r.password);r(s?null:new Error("no matching user"),s)}));const w=p.a.initialize(),P=p.a.session(),U=o()(),j=d()({genid:e=>g()(),resave:!1,saveUninitialized:!1,secret:"sample_session_secret"});U.use(n()({credentials:!0,origin:"http://localhost:8080"})),U.use(j),U.use(w),U.use(P);const N=new y.PubSub,_=new h.ApolloServer({context:e=>({passport:q({request:e.req,response:e.res}),pubsub:N}),playground:{settings:{"request.credentials":"same-origin"}},resolvers:x,typeDefs:S});_.applyMiddleware({app:U,cors:!1,path:"/graphql"});const M=u.a.createServer(U);_.installSubscriptionHandlers(M),M.listen(process.env.PORT,()=>{console.log(`Server ready at http://localhost:${process.env.PORT}${_.graphqlPath}`),console.log(`Subscriptions ready at ws://localhost:${process.env.PORT}${_.subscriptionsPath}`)})}]);
//# sourceMappingURL=index.js.map